{{>header}}
  
  <div id="content">
    
    <div id="primaryTabs">
      <ul>
        <li><a href="#account"><strong>Your Account</strong></a></li>
        {{#plan.options.cname}}
        <li><a href="#cname"><strong>Branding</strong></a></li>
        {{/plan.options.cname}}
        {{#plan.options.api}}
        <li><a href="#apikey"><strong>API Key</strong></a></li>
        {{/plan.options.api}}
        {{#colonel}}
        <li><a href="#labs"><strong>Labs</strong></a></li>
        {{/colonel}}
      </ul>
      <div id="account">
        {{>partial/session_messages}}
        <hr/>
        
        <strong>Account type: {{plan.options.name}}</strong>
        {{#bogus}}
        {{#is_paid}}(${{price}} per month){{/is_paid}}
        {{^is_paid}}(It's free<em>!</em>){{/is_paid}}
        {{/bogus}}
        <hr/>
        
        {{#bogus}}
        {{#is_paid}}<p class="msg">We will request billing info on or before February 1st, 2012.</p>{{/is_paid}}
        {{/bogus}}
        
        <form action="/account" method="post">
          {{{add_shrimp}}}
          <input type="hidden" name="tabindex" value="account" />
          <div>
            <em><label for="custid">Email Address:</label>
            {{cust.custid}}</em><br/>
            <hr/>
            <label for="currentp">Current Password:</label>
            <input type="password" name="currentp" id="currentp" class="short" /><br/>
            <label for="newp">New Password:</label>
            <input type="password" name="newp" id="newp" class="short" /><br/>
            <label for="newp2">Confirm New Password:</label>
            <input type="password" name="newp2" id="newp2" class="short" />
            <hr/>
          </div>
          
          <span id="fireSmall" class="button"><button type="submit">Update Info</button></span>
        </form>
        <hr/>
        
      </div>
      
      {{#plan.options.cname}}
      <div id="cname">
        {{>partial/session_messages}}
        <hr/>
        
        <form action="/account/subdomain" method="post">
          {{{add_shrimp}}}
          <input type="hidden" name="tabindex" value="cname" />
          
          <strong><label for="cnameField"></label>
          <input type="text" name="cname" id="cnameField" class="short" value="{{cname}}" />.onetimesecret.com</strong> {{#has_cname}}(<a href="{{cname_uri}}" class="smaller lighter">Link</a>){{/has_cname}}<br/>
          <hr/>
          <label for="companyField">Company:</label>
          <input type="text" name="company" id="companyField" class="long" value="{{cust_subdomain.company}}" /><br/>

          <label for="homepageField">Homepage:</label>
          <input type="text" name="homepage" id="homepageField" class="long" value="{{cust_subdomain.homepage}}" /><br/>

          <label for="contactField">Contact Name:</label>
          <input type="text" name="contact" id="contactField" class="long" value="{{cust_subdomain.contact}}" /><br/>

          <label for="emailField">Contact Email:</label>
          <input type="text" name="email" id="emailField" class="long" value="{{cust_subdomain.email}}" /><br/>
          <div class="smaller lighter">Emails are sent from this address. If you have problems, let us know.</div>

          <label for="logoURLField">Logo URL:</label>
          <input type="text" name="logo_uri" id="logoURLField" class="long" value="{{cust_subdomain.logo_uri}}" /><br/>
          
          <label for="colorPrimaryField">Primary color:</label>
          <input type="text" name="cp" id="colorPrimaryField" class="short" value="{{cust_subdomain.primary_color}}" /><br/>

          <label for="colorSecondaryField">Secondary color:</label>
          <input type="text" name="cs" id="colorSecondaryField" class="short" value="{{cust_subdomain.secondary_color}}" /><br/>

          <label for="colorBorderField">Border color:</label>
          <input type="text" name="cb" id="colorBorderField" class="short" value="{{cust_subdomain.border_color}}" /><br/>

          <span id="fireSmall" class="button"><button type="submit">Update Branding</button></span>
        </form>
        
      </div>
      {{/plan.options.cname}}
      
      {{#plan.options.api}}
      <div id="apikey">
        {{>partial/session_messages}}
        <hr/>

        <form action="/account/apikey" method="post">
          {{{add_shrimp}}}
          <input type="hidden" name="tabindex" value="apikey" />
          <div>
            <label for="custid">Your API key:</label>
            <span class="hilite">{{#cust.apitoken}}{{cust.apitoken}}{{/cust.apitoken}}</span>
            {{^cust.apitoken}}<em>Click button to generate</em>{{/cust.apitoken}}
            <p class="smaller lighter">DO NOT SHARE YOUR KEY. When in doubt, generate a new one.</p>
          </div>
          <span id="fireSmall" class="button"><button type="submit">Regenerate Key</button></span>
        </form>
        <hr/>
      </div>
      {{/plan.options.api}}
      
      {{#colonel}}
      <div id="labs">
        
        <em class="msg">These features are experimental.</em>
        
        <h2 class="intro">Password Generator </h2>
        <p><a href="" id="generatedBookmarklet">OTPassGen</a> &lt;-- drag to toolbar</p>
        <!--<p>Password formula: unique token + host + master password</p>-->
        <form action="/account/passgen" method="post">
          {{{add_shrimp}}}
          <input type="hidden" name="tabindex" value="labs" />
          <p>
            Your unique token:<br/>
            <input id="uniqueToken" name="passgen_token" value="{{token}}" class="selectable" size="60" /><br/>
            <span class="lighter smaller">(Hint: you can change it to anything you like)</span>
          </p>
          <span id="fireSmall" class="button"><button type="submit">Update Token</button></span>
        </form>
        <p class="smaller">Careful: make a note of your unique token.</p>
        <script type="text/javascript" src="/app/passgen-template.js"></script>
        <script type="text/javascript">
          function updateBookmarklet(token) {
            var template = '(' + passgenTemplate.toString() + ')();'
            var jscontent = Mustache.to_html(template, {CHANGEMECHANGEME: token})
            var packer = new Packer;
            var bookmarklet = encodeURI(packer.pack(jscontent, false));
            $('#generatedBookmarklet').attr('href', 'javascript:/*v0.3*/' + bookmarklet)
          }
          $('#uniqueToken').change(function() {
            updateBookmarklet($('#uniqueToken').val());
          });
          updateBookmarklet($('#uniqueToken').val());
        </script>
        
        <h3>Try it !</h3>
        
        <ol>
          <li>Drag the link above to your toolbar</li>
          <li>Click on the input box below</li>
          <li>Click the bookmarklet</li>
          <li>Enter a Master Password (can be anything)</li>
          <li>Hit enter or click "Generate"</li>
        </ol>
        <p><input id="" type="password" class="long" /></p>
        
        
      </div>
      {{/colonel}}
      
    </div>
    
    <hr/>
    
  </div>
  
  {{#form_fields.tabindex}}
  <script type="text/javascript">
    $(function() { 
      $('#primaryTabs').tabs('option', 'selected', '{{to_s}}')
    });
  </script>
  {{/form_fields.tabindex}}
  
{{>footer}}
